<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Therapy Room</title>
<style>
body { font-family:'Montserrat',sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; background:#fff; }
.panel { width:400px; padding:30px; border-radius:15px; background:#f9f9f9; text-align:center; box-shadow:0 0 20px rgba(0,0,0,0.1);}
input, select, button { width:100%; padding:10px; margin:10px 0; font-size:16px; border-radius:8px; border:1px solid #aaa; }
button { background:#9b59b6; color:#fff; border:none; cursor:pointer; }
a { word-break:break-word; color:#5e2ca5; display:block; margin:10px 0;}
</style>
</head>
<body>
<div class="panel">
<h2>Set Duration & Generate Link</h2>
<input type="password" id="password" placeholder="Enter Password">
<select id="duration">
  <option value="5">5 Minutes</option>
  <option value="10">10 Minutes</option>
  <option value="15">15 Minutes</option>
  <option value="30" selected>30 Minutes</option>
  <option value="60">60 Minutes</option>
</select>
<button id="generateBtn">Generate Link</button>

<div id="linkDiv" style="display:none;">
  <p>Your Meeting Link:</p>
  <a href="#" id="meetingLink" target="_blank"></a>
</div>
</div>

<script>
const PASSWORD = "Wealthy@62";
const BASE = "https://hdigitalpro7.github.io/videomeeting/WEB_UIKITS.html";

function makeId(len=8){ return Math.random().toString(36).substring(2,2+len); }

// Generate link button click
document.getElementById('generateBtn').addEventListener('click',()=>{
  const pass = document.getElementById('password').value;
  const duration = document.getElementById('duration').value;
  if(pass !== PASSWORD){ alert("❌ Incorrect password"); return; }

  // Create a unique meeting ID
  const meetingId = makeId();
  const link = `${BASE}?meetingId=${meetingId}&duration=${duration}`;

  // Save to localStorage: only 1 user can join
  localStorage.setItem("activeMeeting", JSON.stringify({id:meetingId, duration:duration, joined:false}));

  const linkA = document.getElementById('meetingLink');
  linkA.href = link;
  linkA.textContent = link;
  document.getElementById('linkDiv').style.display = 'block';
});

// Check if someone opens the meeting link
if(window.location.pathname.endsWith("WEB_UIKITS.html")){
  const params = new URLSearchParams(window.location.search);
  const meetingId = params.get("meetingId");

  const active = JSON.parse(localStorage.getItem("activeMeeting"));
  if(!active || active.id !== meetingId){
    document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;color:red;'>❌ This link has expired. Please rebook your session.</h2>";
  } else if(active.joined){
    document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;color:red;'>❌ This link has already been used. Please rebook your session.</h2>";
  } else {
    // Mark the meeting as joined
    active.joined = true;
    localStorage.setItem("activeMeeting", JSON.stringify(active));
    document.body.innerHTML = `<h2 style='text-align:center;margin-top:50px;color:green;'>✅ Welcome to your session! Duration: ${active.duration} minutes.</h2>`;
  }
}
</script>
</body>
</html>
